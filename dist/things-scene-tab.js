!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("@hatiolab/things-scene")):"function"==typeof define&&define.amd?define(["exports","@hatiolab/things-scene"],t):t((e=e||self)["things-scene-tab"]={},e.scene)}(this,function(e,t){"use strict";t.Component.register("tab-button",class extends(t.RectPath(t.Component)){get index(){return this.model.index}get activated(){return this.parent.activeIndex===this.index}removed(e){this.dispose()}prerender(e){super.prerender(e);let{fillStyle:t,activeFillStyle:i,activeLineColor:n,activeLineWidth:o,fontColor:r,activeFontColor:l}=this.model;this.hasOwnProperty("_fillStyle")||(this._fillStyle=t),this.hasOwnProperty("_fontColor")||(this._fontColor=r),this.activated?(this.model.fillStyle=i,this.model.fontColor=l,this.model.strokeStyle=n,this.model.lineWidth=o):(this.model.fillStyle=this._fillStyle,this.model.fontColor=this._fontColor,this.model.strokeStyle=this._strokeStyle,this.model.lineWidth=this._lineWidth)}render(e){var{left:t=0,top:i=0,width:n,height:o}=this.bounds;e.beginPath(),e.rect(t,i,n,o),this.drawFill(e),this.drawStroke(e)}postrender(e){super.postrender(e),this.model.fillStyle=this._fillStyle,this.model.fontColor=this._fontColor,this.model.strokeStyle=this._strokeStyle,this.model.lineWidth=this._lineWidth,delete this._fillStyle,delete this._fontColor,delete this._strokeStyle,delete this._lineWidth}onclick(e){this.parent.activeIndex=this.index,this.parent.invalidate()}onchange(e){e.hasOwnProperty("fillStyle")&&(this._fillStyle=e.fillStyle),e.hasOwnProperty("fontColor")&&(this._fontColor=e.fontColor),e.hasOwnProperty("strokeStyle")&&(this._fontColor=e.fontColor),e.hasOwnProperty("lineWidth")&&(this._fontColor=e.fontColor),e.hasOwnProperty("text")&&this.parent.reference.getAt(this.index).set("text",e.text),this.invalidate()}});const i=25,n=25;const o={mutable:!1,resizable:!0,rotatable:!0,properties:[{type:"string",label:"tab-reference",name:"reference",property:"reference"},{type:"number",label:"tab-active-index",name:"activeIndex",property:{min:0,step:1}},{type:"color",label:"active-fill-style",name:"activeFillStyle",property:"activeFillStyle"},{type:"color",label:"active-font-color",name:"activeFontColor",property:"activeFontColor"},{type:"color",label:"active-line-color",name:"activeLineColor",property:"activeLineColor"},{type:"number",label:"active-line-width",name:"activeLineWidth",property:"activeLineWidth"}]};class r extends t.Container{get layout(){let{width:e,height:i}=this.model;return e>=i?t.LinearHorizontalLayout:t.LinearVerticalLayout}get nature(){return o}get focusible(){return!1}get reference(){var{reference:e}=this.model;return e?(this._reference||(this._reference=this.root.findById(e),this._reference&&this._reference.on("change",this.onRefChanged,this)),this._reference):null}get labelHeight(){var e=this.reference.components.length,t=this.model.height;return e>0&&t/e||t}get activeIndex(){return this.get("activeIndex")}set reference(e){this.reference&&this.reference.off("change",this.onRefChanged,this),this._reference=null,this.model.reference=e}set activeIndex(e){this.set("activeIndex",e),this.reference&&(this.reference.activeIndex=e)}render(e){if(super.render(e),this.reference)this.size()!==this.reference.size()&&this.rebuildTabButtons(e);else for(var t=this.components.length-1;t>=0;t--){var i=this.components[t];this.removeComponent(i)}}postrender(e){if(super.postrender(e),!this.app.isEditMode)return;var{left:t,top:o,width:r,fillStyle:l}=this.model;e.beginPath(),e.rect(t+r,o,i,n);e.fillStyle=`rgba(${235}, ${235}, ${235}, ${1})`,e.fill(),e.closePath()}contains(e,t){if(!this.app.isEditMode)return super.contains(e,t);if(super.contains(e,t))return!0;var{left:o,top:r,width:l}=this.bounds,s=o+l,h=n;return e<Math.max(s+i,s)&&e>Math.min(s+i,s)&&t<Math.max(r+h,r)&&t>Math.min(r+h,r)}dispose(){this.reference&&this.reference.off("change",this.onRefChanged,this),super.dispose()}rebuildTabButtons(){var{tabIndex:e=0,left:i,top:n,width:o,height:r,fillStyle:l,activeFillStyle:s,activeLineColor:h,activeLineWidth:a,strokeStyle:d,fontColor:c,activeFontColor:f,fontFamily:p,fontSize:y,lineHeight:m,italic:v,bold:u,lineWidth:g=0}=this.model;let b=[],C=this.reference.components;this.labelHeight;for(var S=this.components.length-1;S>=0;S--)this.removeComponent(this.components[S]);for(let e=0;e<C.length;e++){if("floor"!=C[e].model.type)continue;let i=C[e].text||"";b.push(t.Model.compile({type:"tab-button",index:e,text:i||String(e+1),fillStyle:l||"transparent",activeFillStyle:s,activeLineColor:h,activeLineWidth:a,fontColor:c,activeFontColor:f||c,fontFamily:p,fontSize:y,lineHeight:m,italic:v,bold:u,strokeStyle:d,lineWidth:g,left:0,top:0,width:o,height:r}))}this.add(b),this.reflow(),this.activeIndex=this.model.activeIndex||0}setTabButtonsStyle(e){var t=this.components;for(var i in t){t[i].set(e)}}onRefChanged(e,t,i){}onchange(e,t){e.hasOwnProperty("reference")&&(this.reference=e.reference,this.invalidate()),this.setTabButtonsStyle(e)}}t.Component.register("tab",r),e.Tab=r,Object.defineProperty(e,"__esModule",{value:!0})});
