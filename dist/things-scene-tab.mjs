import{RectPath as e,Component as t,Container as i,LinearHorizontalLayout as r,LinearVerticalLayout as o,Model as n}from"@hatiolab/things-scene";t.register("tab-button",class extends(e(t)){get index(){return this.model.index}get activated(){return this.parent.activeIndex===this.index}removed(e){this.dispose()}prerender(e){super.prerender(e);let{fillStyle:t,activeFillStyle:i,activeLineColor:r,activeLineWidth:o,fontColor:n,activeFontColor:l}=this.model;this.hasOwnProperty("_fillStyle")||(this._fillStyle=t),this.hasOwnProperty("_fontColor")||(this._fontColor=n),this.activated?(this.model.fillStyle=i,this.model.fontColor=l,this.model.strokeStyle=r,this.model.lineWidth=o):(this.model.fillStyle=this._fillStyle,this.model.fontColor=this._fontColor,this.model.strokeStyle=this._strokeStyle,this.model.lineWidth=this._lineWidth)}render(e){var{left:t=0,top:i=0,width:r,height:o}=this.bounds;e.beginPath(),e.rect(t,i,r,o),this.drawFill(e),this.drawStroke(e)}postrender(e){super.postrender(e),this.model.fillStyle=this._fillStyle,this.model.fontColor=this._fontColor,this.model.strokeStyle=this._strokeStyle,this.model.lineWidth=this._lineWidth,delete this._fillStyle,delete this._fontColor,delete this._strokeStyle,delete this._lineWidth}onclick(e){this.parent.activeIndex=this.index,this.parent.invalidate()}onchange(e){e.hasOwnProperty("fillStyle")&&(this._fillStyle=e.fillStyle),e.hasOwnProperty("fontColor")&&(this._fontColor=e.fontColor),e.hasOwnProperty("strokeStyle")&&(this._fontColor=e.fontColor),e.hasOwnProperty("lineWidth")&&(this._fontColor=e.fontColor),e.hasOwnProperty("text")&&this.parent.reference.getAt(this.index).set("text",e.text),this.invalidate()}});const l=25,s=25;const h={mutable:!1,resizable:!0,rotatable:!0,properties:[{type:"string",label:"tab-reference",name:"reference",property:"reference"},{type:"number",label:"tab-active-index",name:"activeIndex",property:{min:0,step:1}},{type:"color",label:"active-fill-style",name:"activeFillStyle",property:"activeFillStyle"},{type:"color",label:"active-font-color",name:"activeFontColor",property:"activeFontColor"},{type:"color",label:"active-line-color",name:"activeLineColor",property:"activeLineColor"},{type:"number",label:"active-line-width",name:"activeLineWidth",property:"activeLineWidth"}]};class a extends i{get layout(){let{width:e,height:t}=this.model;return e>=t?r:o}get nature(){return h}get focusible(){return!1}get reference(){var{reference:e}=this.model;return e?(this._reference||(this._reference=this.root.findById(e),this._reference&&this._reference.on("change",this.onRefChanged,this)),this._reference):null}get labelHeight(){var e=this.reference.components.length,t=this.model.height;return e>0&&t/e||t}get activeIndex(){return this.get("activeIndex")}set reference(e){this.reference&&this.reference.off("change",this.onRefChanged,this),this._reference=null,this.model.reference=e}set activeIndex(e){this.set("activeIndex",e),this.reference&&(this.reference.activeIndex=e)}render(e){if(super.render(e),this.reference)this.size()!==this.reference.size()&&this.rebuildTabButtons(e);else for(var t=this.components.length-1;t>=0;t--){var i=this.components[t];this.removeComponent(i)}}postrender(e){if(super.postrender(e),!this.app.isEditMode)return;var{left:t,top:i,width:r,fillStyle:o}=this.model;e.beginPath(),e.rect(t+r,i,l,s);e.fillStyle=`rgba(${235}, ${235}, ${235}, ${1})`,e.fill(),e.closePath()}contains(e,t){if(!this.app.isEditMode)return super.contains(e,t);if(super.contains(e,t))return!0;var{left:i,top:r,width:o}=this.bounds,n=i+o,h=s;return e<Math.max(n+l,n)&&e>Math.min(n+l,n)&&t<Math.max(r+h,r)&&t>Math.min(r+h,r)}dispose(){this.reference&&this.reference.off("change",this.onRefChanged,this),super.dispose()}rebuildTabButtons(){var{tabIndex:e=0,left:t,top:i,width:r,height:o,fillStyle:l,activeFillStyle:s,activeLineColor:h,activeLineWidth:a,strokeStyle:d,fontColor:c,activeFontColor:f,fontFamily:p,fontSize:y,lineHeight:v,italic:m,bold:g,lineWidth:u=0}=this.model;let b=[],S=this.reference.components;this.labelHeight;for(var C=this.components.length-1;C>=0;C--)this.removeComponent(this.components[C]);for(let e=0;e<S.length;e++){if("floor"!=S[e].model.type)continue;let t=S[e].text||"";b.push(n.compile({type:"tab-button",index:e,text:t||String(e+1),fillStyle:l||"transparent",activeFillStyle:s,activeLineColor:h,activeLineWidth:a,fontColor:c,activeFontColor:f||c,fontFamily:p,fontSize:y,lineHeight:v,italic:m,bold:g,strokeStyle:d,lineWidth:u,left:0,top:0,width:r,height:o}))}this.add(b),this.reflow(),this.activeIndex=this.model.activeIndex||0}setTabButtonsStyle(e){var t=this.components;for(var i in t){t[i].set(e)}}onRefChanged(e,t,i){}onchange(e,t){e.hasOwnProperty("reference")&&(this.reference=e.reference,this.invalidate()),this.setTabButtonsStyle(e)}}t.register("tab",a);export{a as Tab};
